<!DOCTYPE html>
<html>
<head>
    <title>AI Content Agent</title>
</head>
<body>
    <h1>AI Content Agent</h1>
    
    <form id="contentForm">
        <h2>1. Core Topic</h2>
        <textarea id="topicIdea" placeholder="What content do you want to create?" required></textarea>
        <br><br>

        <h2>2. Content Type</h2>
        <input type="radio" id="blog" name="contentType" value="Blog" checked>
        <label for="blog">Blog</label>
        
        <input type="radio" id="image" name="contentType" value="Image">
        <label for="image">Image</label>
        
        <input type="radio" id="video" name="contentType" value="Video">
        <label for="video">Video</label>
        
        <input type="radio" id="campaign" name="contentType" value="Campaign">
        <label for="campaign">Full Campaign (All)</label>
        <br><br>

        <div id="dynamicSpecs" style="display:none;">
            <h2>3. Content Specifications</h2>
            
            <div id="blogSpecs">
                <label>Word Count:</label>
                <input type="number" id="wordCount" value="1500" min="100" max="5000">
                <br><br>
            </div>

            <div id="imageSpecs" style="display:none;">
                <label>Number of Images:</label>
                <input type="range" id="imageCount" min="1" max="3" value="1">
                <span id="imageCountValue">1</span>
                <br><br>
            </div>

            <div id="videoSpecs" style="display:none;">
                <label>Video Duration:</label><br>
                <input type="radio" name="videoDuration" value="15"> 15s
                <input type="radio" name="videoDuration" value="30" checked> 30s
                <input type="radio" name="videoDuration" value="45"> 45s
                <input type="radio" name="videoDuration" value="60"> 60s
                <br><br>
            </div>
            
            <div id="campaignSpecs" style="display:none;">
                <p><strong>Campaign will generate:</strong></p>
                <label>Blog Word Count:</label>
                <input type="number" id="campaignWordCount" value="1500" min="100" max="5000">
                <br><br>
                <label>Number of Images:</label>
                <input type="range" id="campaignImageCount" min="1" max="3" value="2">
                <span id="campaignImageCountValue">2</span>
                <br><br>
                <label>Video Duration:</label><br>
                <input type="radio" name="campaignVideoDuration" value="15"> 15s
                <input type="radio" name="campaignVideoDuration" value="30" checked> 30s
                <input type="radio" name="campaignVideoDuration" value="45"> 45s
                <input type="radio" name="campaignVideoDuration" value="60"> 60s
                <br><br>
            </div>
        </div>

        <h2>4. Target Audience & Goal</h2>
        <label>Target Audience:</label><br>
        <textarea id="targetAudience" placeholder="e.g., Marketing managers" required></textarea>
        <br><br>

        <label>Business Goal:</label>
        <select id="businessGoal" required>
            <option value="Awareness">Awareness</option>
            <option value="Lead Generation">Lead Generation</option>
            <option value="Conversion">Conversion</option>
            <option value="Engagement">Engagement</option>
        </select>
        <br><br>

        <h2>5. Brand Style</h2>
        <label>Brand Tone:</label>
        <select id="brandTone" required>
            <option value="Expert & Formal">Expert & Formal</option>
            <option value="Friendly & Witty">Friendly & Witty</option>
            <option value="Casual & Rebellious">Casual & Rebellious</option>
        </select>
        <br><br>

        <label>Brand Color:</label>
        <input type="color" id="brandColor" value="#007bff">
        <br><br>

        <button type="submit" id="submitBtn">Generate Content</button>
    </form>

    <div id="loading" style="display:none;">
        <h2>Loading...</h2>
        <p>Generating your content. This may take up to <span id="estimatedTime">60</span> seconds.</p>
        <p id="loadingDetails"></p>
    </div>

    <div id="results" style="display:none;">
        <h2>Generated Content</h2>
        
        <div id="videoResults"></div>
        <div id="imageResults"></div>
        <div id="blogResults"></div>

        <br>
        <button onclick="resetForm()">Create New Content</button>
    </div>

    <div id="errorContainer"></div>

    <script>
        const FASTAPI_URL = 'http://127.0.0.1:8000';
        const SUBMIT_ENDPOINT = FASTAPI_URL + '/submit-content-brief';

        // Handle content type changes
        document.querySelectorAll('input[name="contentType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                updateSpecifications(this.value);
            });
        });

        function updateSpecifications(contentType) {
            const dynamicSpecs = document.getElementById('dynamicSpecs');
            document.getElementById('blogSpecs').style.display = 'none';
            document.getElementById('imageSpecs').style.display = 'none';
            document.getElementById('videoSpecs').style.display = 'none';
            document.getElementById('campaignSpecs').style.display = 'none';
            
            dynamicSpecs.style.display = 'block';
            
            if (contentType === 'Blog') {
                document.getElementById('blogSpecs').style.display = 'block';
            } else if (contentType === 'Image') {
                document.getElementById('imageSpecs').style.display = 'block';
            } else if (contentType === 'Video') {
                document.getElementById('videoSpecs').style.display = 'block';
            } else if (contentType === 'Campaign') {
                document.getElementById('campaignSpecs').style.display = 'block';
            }
        }

        // Image count slider
        document.getElementById('imageCount').addEventListener('input', function() {
            document.getElementById('imageCountValue').textContent = this.value;
        });
        
        document.getElementById('campaignImageCount').addEventListener('input', function() {
            document.getElementById('campaignImageCountValue').textContent = this.value;
        });

        // Initialize
        updateSpecifications('Blog');

        // Form submission
        document.getElementById('contentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Generating...';
            
            const contentType = document.querySelector('input[name="contentType"]:checked').value;
            
            const payload = {
                topic_idea: document.getElementById('topicIdea').value,
                target_audience: document.getElementById('targetAudience').value,
                business_goal: document.getElementById('businessGoal').value,
                brand_tone: document.getElementById('brandTone').value,
                brand_color_hex: document.getElementById('brandColor').value
            };

            let estimatedTime = 60;
            
            if (contentType === 'Blog') {
                payload.primary_format = 'Blog Post';
                payload.word_count = parseInt(document.getElementById('wordCount').value);
                payload.item_count = 1;
                document.getElementById('loadingDetails').textContent = 'Generating blog post...';
            } else if (contentType === 'Image') {
                payload.primary_format = 'Image';
                payload.item_count = parseInt(document.getElementById('imageCount').value);
                estimatedTime = 60 + (payload.item_count * 30);
                document.getElementById('loadingDetails').textContent = 'Generating ' + payload.item_count + ' image(s)...';
            } else if (contentType === 'Video') {
                payload.primary_format = 'Video';
                const selectedDuration = document.querySelector('input[name="videoDuration"]:checked');
                payload.video_duration_seconds = parseInt(selectedDuration.value);
                payload.item_count = 1;
                estimatedTime = 120 + (payload.video_duration_seconds * 2);
                document.getElementById('loadingDetails').textContent = 'Generating ' + payload.video_duration_seconds + 's video...';
            } else if (contentType === 'Campaign') {
                payload.primary_format = 'Campaign';
                payload.word_count = parseInt(document.getElementById('campaignWordCount').value);
                payload.item_count = parseInt(document.getElementById('campaignImageCount').value);
                const selectedDuration = document.querySelector('input[name="campaignVideoDuration"]:checked');
                payload.video_duration_seconds = parseInt(selectedDuration.value);
                estimatedTime = 180 + (payload.item_count * 30) + (payload.video_duration_seconds * 2);
                document.getElementById('loadingDetails').textContent = 'Generating full campaign (blog + ' + payload.item_count + ' images + video)...';
            }

            document.getElementById('estimatedTime').textContent = estimatedTime;

            document.getElementById('contentForm').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('errorContainer').innerHTML = '';
            document.getElementById('results').style.display = 'none';

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 300000);
                
                const response = await fetch(SUBMIT_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (response.ok) {
                    const data = await response.json();
                    console.log('SUCCESS:', data);
                    displayResults(data);
                } else {
                    const errorText = await response.text();
                    console.error('Error:', errorText);
                    showError('Error: ' + response.status, errorText);
                }
            } catch (error) {
                console.error('Error:', error);
                
                if (error.name === 'AbortError') {
                    showError('Timeout Error', 'Request took too long');
                } else if (error.message.includes('Failed to fetch')) {
                    showError('Connection Error', 'Cannot connect to backend at ' + FASTAPI_URL);
                } else {
                    showError('Error', error.message);
                }
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Generate Content';
            }
        });

        function displayResults(data) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('results').style.display = 'block';

            const generatedContent = data.generated_content || {};
            
            document.getElementById('videoResults').innerHTML = '';
            document.getElementById('imageResults').innerHTML = '';
            document.getElementById('blogResults').innerHTML = '';
            
            // Display video
            if (generatedContent.video_file_path) {
    const videoPath = generatedContent.video_file_path;
    const videoUrl = FASTAPI_URL + '/' + videoPath;
    
    // Check if thumbnail exists
    let videoHTML = '<h3>Generated Video</h3>';
    
    if (generatedContent.video_thumbnail_path) {
        const thumbnailPath = generatedContent.video_thumbnail_path;
        const thumbnailUrl = FASTAPI_URL + '/' + thumbnailPath;
        
        // Video with poster thumbnail
        videoHTML += '<video controls width="800" poster="' + thumbnailUrl + '">' +
                    '<source src="' + videoUrl + '" type="video/mp4"></video>';
    } else {
        // Video without poster
        videoHTML += '<video controls width="800"><source src="' + videoUrl + '" type="video/mp4"></video>';
    }
    
    videoHTML += '<br><a href="' + videoUrl + '" download>Download Video</a><br><br>';
    
    document.getElementById('videoResults').innerHTML = videoHTML;
}
            
            // Display images
            if (generatedContent.image_file_paths && generatedContent.image_file_paths.length > 0) {
                const imagePaths = generatedContent.image_file_paths;
                let imageHTML = '<h3>Generated Images (' + imagePaths.length + ')</h3>';
                
                imagePaths.forEach((path, index) => {
                    const imageUrl = FASTAPI_URL + '/' + path;
                    imageHTML += '<div><p>Image ' + (index + 1) + '</p>' +
                                '<img src="' + imageUrl + '" width="400" alt="Image ' + (index + 1) + '"><br>' +
                                '<a href="' + imageUrl + '" download>Download Image ' + (index + 1) + '</a><br><br></div>';
                });
                
                document.getElementById('imageResults').innerHTML = imageHTML;
            }

            // Display blog
            if (generatedContent.blog_post) {
                const formattedBlog = generatedContent.blog_post.replace(/\n\n/g, '<br><br>').replace(/\n/g, '<br>');
                document.getElementById('blogResults').innerHTML = 
                    '<h3>Generated Blog Post</h3>' +
                    '<div>' + formattedBlog + '</div><br>';
            }
        }

        function showError(title, message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('contentForm').style.display = 'block';
            
            document.getElementById('errorContainer').innerHTML = 
                '<div style="color:red;border:1px solid red;padding:10px;margin:10px 0;">' +
                '<strong>' + title + '</strong><br>' + message + '</div>';
        }

        function resetForm() {
            document.getElementById('results').style.display = 'none';
            document.getElementById('contentForm').style.display = 'block';
            document.getElementById('contentForm').reset();
            document.getElementById('videoResults').innerHTML = '';
            document.getElementById('imageResults').innerHTML = '';
            document.getElementById('blogResults').innerHTML = '';
            document.getElementById('errorContainer').innerHTML = '';
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Generate Content';
            
            updateSpecifications('Blog');
        }
    </script>
</body>
</html>